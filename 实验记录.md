# ç›®å½•

[TOC]



# å®éªŒè®°å½• 2019-11-08

##å¯ä»¥è¯»dblpçš„æ•°æ®

ä¹‹å‰å°è¯•ä½¿ç”¨spark-xmlè¯»å–dblpçš„æ•°æ®ï¼Œä½†æ˜¯è¯»å–è¿‡ç¨‹ä¸­å‘ç”ŸOOMå¼‚å¸¸ã€‚

ä¸€æ¬¡æ€§è¯»å–å…¨éƒ¨dblpæ•°æ®çš„ä»£ç å¦‚ä¸‹ï¼š

```scala
    val df = spark.read
      .format("com.databricks.spark.xml")
      .option("rowTag", "dblp")
      .load("file:///root/dblp.xml")
```

è¿™ç§è¯»å–çš„æ–¹å¼å¯¼è‡´sparkçš„Excutorç«¯ç”Ÿæˆäº†è¿‡äºåºå¤§çš„SchemaRDDï¼Œå¯¼è‡´äº†OOMå¼‚å¸¸ã€‚åœ¨æŸ¥é˜…äº†spark-xmlçš„README.mdæ–‡ä»¶åï¼Œæœ€ç»ˆå‘ç°äº†æ­£ç¡®çš„è¯»å–æ–¹å¼ã€‚



README.mdä¸­optionæ”¯æŒçš„é€‰é¡¹éƒ¨åˆ†æ‰¾åˆ°å…³äº`rowTag`å’Œ`rootTag`çš„è¯´æ˜ï¼š

>* `rowTag`: The row tag of your xml files to treat as a row. For example, in this xml `<books> <book><book> ...</books>`, the appropriate value would be `book`. Default is `ROW`.
>* `rootTag`: The root tag of your xml files to treat as the root. For example, in this xml `<books> <book><book> ...</books>`, the appropriate value would be `books`. Default is `ROWS`.

ç®€å•çš„è¯´`rowTag`é€‰é¡¹æ˜¯ç”¨æ¥è®¾ç½®è¦å°†ä»€ä¹ˆxmlèŠ‚ç‚¹è½¬æ¢ä¸ºDataFrameçš„rowï¼Œè€Œ`rootTag`ç”¨æ¥è®¾ç½®è¦å°†æ ¹èŠ‚ç‚¹è®¾ç½®ä¸ºå“ªä¸ªèŠ‚ç‚¹ã€‚

è¿™æ ·å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆä¸€æ¬¡æ€§è¯»å–dblpçš„ä»£ç ä¼šå¯¼è‡´OOMå¼‚å¸¸ã€‚å› ä¸ºdblp.xmlçš„æ ¹èŠ‚ç‚¹æ˜¯dblpèŠ‚ç‚¹ï¼Œä½†æ˜¯å´è¢«å½“æˆäº†rowã€‚è¿™ä¼šåœ¨Excutorç«¯ç”Ÿæˆäº†ä¸€ä¸ªå·¨å¤§çš„RDDå¯¹è±¡ï¼Œå¯¼è‡´OOMã€‚



èƒ½å¤Ÿä¸å¯¼è‡´OOMçš„å‚æ•°è®¾ç½®å¦‚ä¸‹ï¼š

```scala
    val df = spark.read
      .format("com.databricks.spark.xml")
      .option("rootTag", "dblp")
 			.option("rowTag", "article")
      .load("file:///root/dblp.xml")
```

é¿å…ä¸€æ¬¡è¯»å–å…¨éƒ¨dblp.xmlæ•°æ®ï¼Œé‡‡ç”¨åˆ†åˆ«è¯»å–dblpæ ¹èŠ‚ç‚¹ä¸‹çš„å­èŠ‚ç‚¹çš„æ–¹å¼è¯»å–ã€‚



ä½†æ˜¯dblpæ•°æ®é›†çš„å¤§å°æœ‰2gï¼Œæˆ‘ä»¬æ²¡æ³•çŸ¥é“dblpä¸‹ä¸€å±‚çš„å­èŠ‚ç‚¹éƒ½æ˜¯ä»€ä¹ˆï¼Ÿäºæ˜¯å‚è€ƒäº†dblp.dtdæ–‡ä»¶ï¼Œå¾—çŸ¥äº†dblpä¸‹çš„å­—èŠ‚ç‚¹åç§°ã€‚å¹¶å¯¹å„ä¸ªå­—èŠ‚ç‚¹çš„è®°å½•æ•°é‡è¿›è¡Œäº†ç»Ÿè®¡ã€‚

| subElement    | Count   |
| ------------- | ------- |
| article       | 2093906 |
| inproceedings | 2450274 |
| proceedings   | 41782   |
| book          | 17714   |
| incollection  | 59477   |
| phdthesis     | 73252   |
| mastersthesis | 12      |
| www           | 2346866 |
| person        | 0       |
| data          | 0       |

ä¸‹ä¸€æ­¥å‡†å¤‡å°†å„ä¸ªå­èŠ‚ç‚¹å†™å…¥å•ç‹¬çš„xmlæ–‡ä»¶é‡Œ

#å®éªŒè®°å½• 2019-11-14

##ä¿®æ”¹äº†dblpä¸­çš„å®ä½“å®šä¹‰ä¸ºlatin-1ç¼–ç 

è¯»å–æ–‡ä»¶æ—¶å‘ç°å‡ºç°äº†å¤§é‡çš„è®°å½•æ˜¾ç¤ºcorrupt_record

| _corrupt_record | _key | _mdate | _publtype | author | ee   |
| --------------- | ---- | ------ | --------- | ------ | ---- |
|                null|     tr/meltdown/s18|2018-01-07| informal|[Paul Kocher, Dan...|                null|https://spectreat...|
|<article mdate="2...|                null|      null|     null|                null|                null|                null|
|<article mdate="2...|                null|      null|     null|                null|                null|                null|


æ’æŸ¥ä»¥åå‘ç°æ˜¯ç”±äºdblp.xmlå­˜åœ¨ä¸€äº›xmlå®ä½“å®šä¹‰å¯¼è‡´spark-xmlä¸èƒ½æ­£å¸¸è¯»å–ã€‚

```xml
    <article mdate="2017-06-08" key="tr/ibm/IWBS191" publtype="informal">
        <author>Rolf Sander</author>
        <title>Die Repr&auml;sentation r&auml;umlichen Wissens und die Behandlung von Einbettungsproblemen mit Quadtreedepiktionen
        </title>
        <journal>IWBS Report</journal>
        <volume>191</volume>
        <year>1991</year>
        <publisher>IBM Germany Science Center, Institute for Knowledge Based Systems</publisher>
    </article>
```

æŸ¥é˜…äº†spark-xmlçš„readmeæ²¡æœ‰å‘ç°å¯ä»¥æ ¹æ®dtdçš„å®ä½“å®šä¹‰æ›¿æ¢ä¸ºå¯¹åº”çš„latin-1ç¼–ç å­—ç¬¦çš„æ–¹æ³•ï¼Œäºæ˜¯æ‰“ç®—å°†å®ä½“å®šä¹‰ç›¸å…³çš„å­—ç¬¦ä¸²ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¹¶æ›¿æ¢ã€‚è¯»å–dblp.xmlæ›¿æ¢ç›¸åº”çš„å­—ç¬¦ä¸²ä»¥åå†™åˆ°dblp_after.xmlæ–‡ä»¶ä¸­ã€‚

```scala
import java.io.File
import org.apache.spark.sql.SparkSession
object Test4 {
  val s1 = "file:////Users/gaoxin/WorkSpace/spark/dblp.xml"
  //å°†å®ä½“æ›¿æ¢ä»¥åçš„dblpå†™åœ¨è¿™é‡Œ
  val s2 = "file:////Users/gaoxin/WorkSpace/spark/dblp_after.xml"

  def main(args: Array[String]): Unit = {
    val spark = SparkSession
      .builder
      .appName("XML_Test")
      .master("local[*]")
      .getOrCreate()

    val subNode = Array("article")
    
    //æ–‡æœ¬æ–¹å¼è¯»å–
    val file = spark.sparkContext.textFile(s1)

    //è½¬æ¢å®ä½“
    val afterParse = file.map(s => ReplaceEntity.parse(s))
    
    //afterParse.foreach(it => println(it))

    val afterParedblp: File = new File(s2)

   if (afterParedblp.isFile) {
     println("delete "+ afterParedblp.delete())
   }

    afterParse.saveAsTextFile(s2)
  }
}
```



**å°†å®ä½“åç§°æ›¿æ¢ä¸ºå®ä½“ç¼–å·çš„æ–¹å¼å°½ç®¡å¯ä»¥åœ¨ideä¸‹æ­£å¸¸æ˜¾ç¤ºï¼Œä½†æ˜¯ä½¿ç”¨æ§åˆ¶å°çš„æ—¶å€™ä»ç„¶æ˜¾ç¤ºä¹±ç ã€‚åº”è¯¥æ›¿æ¢ä¸ºå…·ä½“å­—ç¬¦ã€‚ä¸‹é¢çš„ä»£ç å¹¶æ²¡æœ‰æ ¹æœ¬åœ°è§£å†³é—®é¢˜ï¼Œä»¥åéœ€è¦æ”¹ã€‚**

```scala
import scala.util.matching.Regex

object ReplaceEntity {
  val regex: Regex = new Regex("&[A-Za-z]*;")
  def parse(s: String): String = {
    val optS = regex.replaceAllIn(s, it => it.toString() match {
      case "&reg;" => "&#174;"
      case "&micro;" => "&#181;"
      case "&times;" => "&#215;"
      case "&Agrave;" => "&#192;"
      case "&Aacute;" => "&#193;"
      case "&Acirc;" => "&#194;"
//.....çœç•¥
      case _ => {
        println(it)
        it.toString()
      }
    })

    optS
  }
}
```

ç»è¿‡å®ä½“æ›¿æ¢ä»¥åçš„dblp_after.xmlå¯ä»¥æ­£å¸¸è¯»å–ï¼Œæ£€æŸ¥äº†dataframeçš„è®°å½•ä¹Ÿæ²¡æœ‰å‘ç°corrupt_recordã€‚

#å®éªŒè®°å½• 2019-11-21

å¯ä»¥è¿›è¡Œç®€å•çš„æŸ¥è¯¢äº†

##é€‰å–ç‰¹å®šçš„åˆ—

```scala
    import spark.implicits._
    dblpArticle.select($"title", $"author", $"url").show()
```

| title                | author               | url                  |
| -------------------- | -------------------- | -------------------- |
| Spectre Attacks: ... | [[Paul Kocher,,],... | null                 |
| Meltdown             | [[Moritz Lipp,,],... | null                 |
| An Evaluation of ... | [[Frank Manola,,]]   | db/labs/gte/index... |

## æ ¹æ®longç±»å‹æ‰§è¡Œè¿‡æ»¤

```scala
import spark.implicits._
dblpArticle.filter($"year" > 2000).show()
```

| title                | author               | year                 |
| -------------------- | -------------------- | -------------------- |
|Spectre Attacks: ...|[[Paul Kocher,,],...|2018|
|            Meltdown|[[Moritz Lipp,,],...|2018|

## å­—ç¬¦ä¸²æ­£åˆ™åŒ¹é…

```scala
import spark.implicits._
dblpArticle.select($"title", $"author", $"url").filter($"title" rlike "^Knowledge").show()
```
| title                | author               | year                 |
| -------------------- | -------------------- | -------------------- |
|Knowledge in Oper...|[[Toni Bollinger,...|null|

å…¶ä»–çš„å†™åœ¨æµ‹è¯•ä»£ç é‡Œäº†

# å®éªŒè®°å½• 2020-02-20

é€šè¿‡dockerå’Œdocker-composeæ­å»ºäº†å®éªŒç¯å¢ƒã€‚

1. Mongodbç¯å¢ƒ
2. Sparkå’ŒHDFSçš„ç¯å¢ƒï¼ˆå¯åœ¨å•æœºè¿›è¡Œä¼ªåˆ†å¸ƒå¼å®éªŒï¼‰
3. Hadoop Yarnç¯å¢ƒï¼ˆå¯åœ¨å•æœºè¿›è¡Œä¼ªåˆ†å¸ƒå¼å®éªŒï¼‰

Sparkç¯å¢ƒå’ŒHadoopç¯å¢ƒæ˜¯ä»¥åˆ«äººçš„dockerfileä¸ºåŸºç¡€æ”¹çš„è¿™æ˜¯Githubçš„åœ°å€ï¼šhttps://github.com/big-data-europe/docker-hadoop

# å®éªŒè®°å½• 2020-02-27

lmhå°†è¿›è¡Œè¿‡é¢„å¤„ç†çš„æ•°æ®å†™å…¥äº†Mongodbï¼Œæ•°æ®å¯ä»¥æ­£å¸¸å†™å…¥ï¼Œå¹¶é€šè¿‡Mongodbè¯»å–ã€‚

è®©xxkå­¦ä¹ é€šè¿‡SpringBoot-jpaç»„ä»¶è¯»å–Mongodbã€‚

# å®éªŒè®°å½• 2020-03-10

å°†ä¹‹å‰çš„ç ”ç©¶æˆæœè¿›è¡Œæ•´ç†

å»ºç«‹è¿œç¨‹ä»“åº“ï¼šhttps://github.com/FHamster/SparkExp

# å®éªŒè®°å½• 2020-03-11

## å‘ç°äº†titleå­—æ®µç©ºç™½çš„é”™è¯¯

ç¿»çœ‹mongodbå†…çš„æ•°æ®æ—¶å‘ç°äº†ä¸¥é‡çš„é”™è¯¯ï¼Œå¤§é‡çš„titleå­—æ®µä¸€ç‰‡ç©ºç™½ã€‚

æ’æŸ¥ä»¥åå‘ç°æ˜¯spark-xmlæ¨å¯¼å‡ºäº†ä¸æœŸæœ›çš„schemaï¼Œå¯¼è‡´titleèŠ‚ç‚¹çš„æ–‡æœ¬å…¨éƒ¨æ²¡è¯»ã€‚

spark-xmlæ¨æµ‹çš„schemaï¼š

```
root
 |-- _cdate: string (nullable = true)
 |-- _key: string (nullable = true)
 |-- _mdate: string (nullable = true)
 |-- _publtype: string (nullable = true)
 |-- author: array (nullable = true)
 |    |-- element: struct (containsNull = true)
 |    |    |-- _VALUE: string (nullable = true)
 |    |    |-- _aux: string (nullable = true)
 |    |    |-- _orcid: string (nullable = true)
 |-- booktitle: string (nullable = true)
 |-- cdrom: string (nullable = true)
 |-- cite: array (nullable = true)
 |    |-- element: struct (containsNull = true)
 |    |    |-- _VALUE: string (nullable = true)
 |    |    |-- _label: string (nullable = true)
 |-- crossref: string (nullable = true)
 |-- editor: array (nullable = true)
 |    |-- element: struct (containsNull = true)
 |    |    |-- _VALUE: string (nullable = true)
 |    |    |-- _orcid: string (nullable = true)
 |-- ee: array (nullable = true)
 |    |-- element: struct (containsNull = true)
 |    |    |-- _VALUE: string (nullable = true)
 |    |    |-- _type: string (nullable = true)
 |-- journal: string (nullable = true)
 |-- month: string (nullable = true)
 |-- note: array (nullable = true)
 |    |-- element: struct (containsNull = true)
 |    |    |-- _VALUE: string (nullable = true)
 |    |    |-- _type: string (nullable = true)
 |-- number: string (nullable = true)
 |-- pages: string (nullable = true)
 |-- publisher: string (nullable = true)
 |-- title: struct (nullable = true)
 |    |-- _VALUE: string (nullable = true)
 |    |-- _bibtex: string (nullable = true)
 |    |-- i: array (nullable = true)
 |    |    |-- element: string (containsNull = true)
 |    |-- sub: array (nullable = true)
 |    |    |-- element: string (containsNull = true)
 |    |-- sup: array (nullable = true)
 |    |    |-- element: string (containsNull = true)
 |-- url: string (nullable = true)
 |-- volume: string (nullable = true)
 |-- year: long (nullable = true)

```

å®šä½äº†å¯¼è‡´è¿™ç§ç°è±¡çš„xmlè®°å½•

```xml
<title>&#120001;<sub>0</sub> Regularized Structured Sparsity Convolutional Neural Networks.</title>

<title>Beyond Ohba's Conjecture: A bound on the choice number of <i>k</i>-chromatic graphs with <i>n</i> vertices.</title>

<title>Asynchronous machine vector control: PI<sup>&#945;</sup> controllers for current loops.</title>
```



åœ¨dblpç½‘ç«™çš„æ˜¾ç¤ºæ•ˆæœ

* **ğ“**0 Regularized Structured Sparsity Convolutional Neural Networks.
* Beyond Ohba's Conjecture: A bound on the choice number of *k*-chromatic graphs with *n* vertices.
* Average dwell time approach to *H*âˆ filter for continuous-time switched linear parameter varying systems with time-varying delay.

**å‘ç°æ–‡ç« çš„æ ‡é¢˜æœ‰ç‰¹æ®Šçš„æ–‡æœ¬æ•ˆæœï¼Œä½†æ˜¯spark-xmlåœ¨å¤„ç†æ—¶ä¸¢å¤±äº†è¿™éƒ¨åˆ†çš„è¯­æ„ã€‚éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥çš„é¢„å¤„ç†ã€‚å¹¶ä¸”è¿™æ„å‘³**

1. ç€å…¶ä»–çš„dblpä¸‹çš„ä¸€çº§å­—èŠ‚ç‚¹ä¹Ÿä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦äººå·¥è®¾å®šä¸å°‘çš„schema ï¼ˆå¤´ç–¼ï¼‰
2. ç½‘é¡µæ˜¾ç¤ºå·¥ä½œéœ€è¦åŠ å…¥è¿™ç§æ˜¾ç¤ºåŠŸèƒ½ ï¼ˆå¤´æ›´ç–¼ï¼‰







# å®éªŒè®°å½• 2020-04-08

## å°è¯•è§£å†³titleç©ºç™½é—®é¢˜ï¼ŒæœªæˆåŠŸ

å°è¯•æ‰‹åŠ¨è®¾å®šschemaä»¥åä»ç„¶äº§ç”Ÿè¿™æ ·çš„ç°è±¡ï¼Œ**æ•ˆæœä¸å¥½**

```json
[
  {
    "title": " Transferability of Adversarial Examples to Attack Cloud-based Image Classifier Service."
  },
  {
    "title": "! and ? - Storage as Tensorial Strength."
  },
  {
    "title": "!MDP Playground: Meta-Features in Reinforcement Learning."
  },
  {
    "title": "\""
  },
  {
    "title": "\""
  },
  {
    "title": "\""
  },
  //è¿™é‡Œçœç•¥
  [
  {
    "title": "\uD83D\uDC4D as social support: Relational closeness, automaticity, and interpreting social support from paralinguistic digital affordances in social media."
  },
  {
    "title": "\uD835\uDD43"
  },
  {
    "title": "\uD835\uDD3D"
  },
  {
    "title": "\uD835\uDD3D"
  },
  {
    "title": "\uD835\uDCDE(k)-robust spanners in one dimension."
  },
  {
    "title": "\uD835\uDCC1"
  },
  {
    "title": "\uD835\uDCC1"
  },
  {
    "title": "\uD835\uDCC1"
  },
  {
    "title": "\uD835\uDCC1"
  },
  {
    "title": "\uD835\uDCC1"
  },
  {
    "title": "\uD835\uDCB1\uD835\uDCB0-smoothness and proximal point results for some nonconvex functions."
  },
  {
    "title": "\uD835\uDCAB-schemes and Deterministic Polynomial Factoring over Finite Fields."
  },
  {
    "title": "í”½"
  },
  {
    "title": "í’Ÿ-stability performance analysis and stabilization of Sun-Earth "
  },
  {
    "title": "í’-Consistency in signed total graphs of commutative rings."
  }
]
]
```

ç›®å‰è®¡åˆ’é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢```<sub>``` ```<sup>``` ```<i>```è¿™æ ·çš„æ ‡ç­¾ï¼Œåœ¨æˆåŠŸè¯»å–ä¸ºdataframeä»¥åå†é€šè¿‡dataframeä¸­è¿›è¡Œå­—ç¬¦ä¸²æ›¿æ¢

## å¯¹titleå­—æ®µçš„ä¸€äº›å‘ç°

```
 |-- title: struct (nullable = true)
 |    |-- _VALUE: string (nullable = true)
 |    |-- _bibtex: string (nullable = true)
 |    |-- i: array (nullable = true)
 |    |    |-- element: string (containsNull = true)
 |    |-- sub: array (nullable = true)
 |    |    |-- element: string (containsNull = true)
 |    |-- sup: array (nullable = true)
 |    |    |-- element: string (containsNull = true)
```

```_VALUE```:titleçš„æ–‡æœ¬

```i```:æ–œä½“
```sup```:ä¸Šæ ‡
```sub```:ä¸‹æ ‡
```_bibtex```:ä½¿ç”¨bibtexè¯­æ³•æè¿°çš„title

